<header><h1>Pet Detective - Observation</h1></header>

<div id="observation-content" class="observation-content">

      <table class="grid">
        <thead>
          <tr>
            <th>Sensor</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: list">
          <tr data-bind="click: click">
            <td data-bind="text: key"></td>
            <td data-bind="text: value"></td>
          </tr>
        </tbody>
      </table>

    </div>

    <script>

    function ObservationPayload( _key, _value ) {
      var self = this;

      self.click = function(e) {
        history.pushState( {}, null, '#sensor/' + obvm.id + '/' + self.key );

        $( ".content" ).load( "page/sensor.htm" );

      }

      self.key = _key;
      self.value = _value;
    }

    function ObViewModel() {
      var self = this;

      self.id = window.location.hash.split( "/" )[1];

      self.list = ko.observableArray();
      self.add = function( key, value ) {
        var op = new ObservationPayload( key, value );
        self.list.push( op );
      }
    }

    var obvm = new ObViewModel();
    ko.applyBindings( obvm, document.getElementById( 'observation-content' ) );

    $.getJSON( "observationpayload/" + obvm.id, function( _l ) {
      _.each( _l, function(el) {
        obvm.add( el.key, el.value );
      });

    });

    </script>
